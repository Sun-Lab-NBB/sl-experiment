from enum import IntEnum
from multiprocessing import Process

from _typeshed import Incomplete
from PyQt6.QtGui import QCloseEvent
from PyQt6.QtWidgets import QLabel, QGroupBox, QMainWindow, QPushButton, QDoubleSpinBox
from ataraxis_data_structures import SharedMemoryArray

from .visualizers import VisualizerMode as VisualizerMode

class _DataArrayIndex(IntEnum):
    TERMINATION = 0
    EXIT_SIGNAL = 1
    REWARD_SIGNAL = 2
    SPEED_MODIFIER = 3
    DURATION_MODIFIER = 4
    PAUSE_STATE = 5
    OPEN_VALVE = 6
    CLOSE_VALVE = 7
    REWARD_VOLUME = 8
    REINFORCING_GUIDANCE_ENABLED = 9
    AVERSIVE_GUIDANCE_ENABLED = 10
    GAS_VALVE_OPEN = 11
    GAS_VALVE_CLOSE = 12
    GAS_VALVE_PUFF = 13
    GAS_VALVE_PUFF_DURATION = 14
    SETUP_COMPLETE = 15

class RuntimeControlUI:
    _data_array: Incomplete
    _valve_tracker: Incomplete
    _gas_puff_tracker: Incomplete
    _mode: VisualizerMode
    _has_reinforcing_trials: bool
    _has_aversive_trials: bool
    _ui_process: Process | None
    _started: bool
    def __init__(self, valve_tracker: SharedMemoryArray, gas_puff_tracker: SharedMemoryArray) -> None: ...
    def __del__(self) -> None: ...
    def start(
        self, mode: VisualizerMode | int = ..., *, has_reinforcing_trials: bool = True, has_aversive_trials: bool = True
    ) -> None: ...
    def shutdown(self) -> None: ...
    def _run_ui_process(
        self, mode: VisualizerMode, *, has_reinforcing_trials: bool, has_aversive_trials: bool
    ) -> None: ...
    def set_pause_state(self, *, paused: bool) -> None: ...
    def set_reinforcing_guidance_state(self, *, enabled: bool) -> None: ...
    def set_aversive_guidance_state(self, *, enabled: bool) -> None: ...
    def set_setup_complete(self) -> None: ...
    @property
    def exit_signal(self) -> bool: ...
    @property
    def reward_signal(self) -> bool: ...
    @property
    def speed_modifier(self) -> int: ...
    @property
    def duration_modifier(self) -> int: ...
    @property
    def pause_runtime(self) -> bool: ...
    @property
    def open_valve(self) -> bool: ...
    @property
    def close_valve(self) -> bool: ...
    @property
    def reward_volume(self) -> int: ...
    @property
    def enable_reinforcing_guidance(self) -> bool: ...
    @property
    def enable_aversive_guidance(self) -> bool: ...
    @property
    def gas_valve_open_signal(self) -> bool: ...
    @property
    def gas_valve_close_signal(self) -> bool: ...
    @property
    def gas_valve_puff_signal(self) -> bool: ...
    @property
    def gas_valve_puff_duration(self) -> int: ...

class _ControlUIWindow(QMainWindow):
    _data_array: SharedMemoryArray
    _valve_tracker: SharedMemoryArray
    _gas_puff_tracker: SharedMemoryArray
    _mode: VisualizerMode
    _has_reinforcing_trials: bool
    _has_aversive_trials: bool
    _is_paused: bool
    _setup_complete: bool
    _reinforcing_guidance_enabled: bool
    _aversive_guidance_enabled: bool
    _reward_in_progress: bool
    _puff_in_progress: bool
    def __init__(
        self,
        data_array: SharedMemoryArray,
        valve_tracker: SharedMemoryArray,
        gas_puff_tracker: SharedMemoryArray,
        mode: VisualizerMode | int = ...,
        *,
        has_reinforcing_trials: bool = True,
        has_aversive_trials: bool = True,
    ) -> None: ...
    exit_btn: Incomplete
    pause_btn: Incomplete
    reinforcing_guidance_btn: QPushButton | None
    aversive_guidance_btn: QPushButton | None
    runtime_status_label: Incomplete
    valve_open_btn: Incomplete
    valve_close_btn: Incomplete
    reward_btn: Incomplete
    volume_spinbox: Incomplete
    valve_status_label: Incomplete
    gas_valve_open_btn: QPushButton | None
    gas_valve_close_btn: QPushButton | None
    gas_puff_btn: QPushButton | None
    gas_duration_spinbox: QDoubleSpinBox | None
    gas_valve_status_label: QLabel | None
    _speed_group: QGroupBox | None
    _duration_group: QGroupBox | None
    speed_spinbox: QDoubleSpinBox | None
    duration_spinbox: QDoubleSpinBox | None
    def _setup_ui(self) -> None: ...
    def _apply_qt6_styles(self) -> None: ...
    monitor_timer: Incomplete
    def _setup_monitoring(self) -> None: ...
    def _check_external_state(self) -> None: ...
    def closeEvent(self, event: QCloseEvent | None) -> None: ...
    def _exit_runtime(self) -> None: ...
    def _deliver_reward(self) -> None: ...
    def _open_valve(self) -> None: ...
    def _close_valve(self) -> None: ...
    def _toggle_pause(self) -> None: ...
    def _update_reward_volume(self) -> None: ...
    def _update_speed_modifier(self) -> None: ...
    def _update_duration_modifier(self) -> None: ...
    @staticmethod
    def _refresh_button_style(button: QPushButton) -> None: ...
    def _update_reinforcing_guidance_ui(self) -> None: ...
    def _update_aversive_guidance_ui(self) -> None: ...
    def _toggle_reinforcing_guidance(self) -> None: ...
    def _toggle_aversive_guidance(self) -> None: ...
    def _update_pause_ui(self) -> None: ...
    def _disable_valve_open_close_buttons(self) -> None: ...
    def _update_gas_puff_duration(self) -> None: ...
    def _gas_valve_open(self) -> None: ...
    def _gas_valve_close(self) -> None: ...
    def _gas_valve_puff(self) -> None: ...
